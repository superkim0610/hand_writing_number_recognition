<!DOCTYPE html>
<html>
<head>
    <title>Canvas Drawing</title>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
    
</head>
<body>
    <h1>Canvas Drawing</h1>
    <canvas id="canvas" width="28" height="28"></canvas>
    <br>
    <button onclick="clearCanvas()">전체 지우기</button>
    <button onclick="sendCanvasData()">보내기</button>
    <div>서버로부터 받은 숫자: <span id="number-display">-</span></div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');
        var isDrawing = false;

        // 캔버스 초기화
        function clearCanvas() {
            context.clearRect(0, 0, canvas.width, canvas.height);
        }

        // 캔버스 이벤트 핸들러
        canvas.addEventListener('mousedown', function (e) {
            isDrawing = true;
            context.beginPath();
            context.moveTo(e.clientX - canvas.getBoundingClientRect().left, e.clientY - canvas.getBoundingClientRect().top);
        });

        canvas.addEventListener('mousemove', function (e) {
            if (!isDrawing) return;
            context.lineTo(e.clientX - canvas.getBoundingClientRect().left, e.clientY - canvas.getBoundingClientRect().top);
            context.stroke();
        });

        canvas.addEventListener('mouseup', function () {
            isDrawing = false;
            sendCanvasData()
        });

        // 캔버스 데이터 전송
        function sendCanvasData() {
            var imageData = context.getImageData(0, 0, canvas.width, canvas.height).data;
            var canvas_data = [];
            for (var i = 0; i < imageData.length; i += 4) {
                var pixelValue = imageData[i+3]
                canvas_data.push(pixelValue);

            }
            socket.emit('canvas_data', canvas_data);
            console.log(canvas_data);
        }

        // 서버로부터 숫자 수신
        socket.on('number', function (data) {
            document.getElementById('number-display').textContent = data.number;
        });
    </script>
</html>
